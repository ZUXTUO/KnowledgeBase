# 相册网盘单脚本版

一个功能全面的图片管理Web应用，采用单文件Flask应用设计，支持图片上传、浏览、评分、标签管理和批量操作等功能。

## 功能特点

- **图片管理**：上传、查看、删除图片
- **标签系统**：为图片添加、编辑和删除标签
- **评分系统**：为图片提供1-5星评分功能
- **浏览模式**：支持列表视图和相册视图
- **批量操作**：批量添加/删除/替换标签，批量重命名
- **分类浏览**：按标签、评分、是否已标记分类浏览
- **随机浏览**：随机浏览图片功能，支持键盘和手势导航
- **导出功能**：将所有图片打包导出为TAR文件
- **响应式设计**：适配桌面端和移动端设备

## 技术架构

- **后端框架**：Flask
- **数据库**：SQLite（嵌入式）
- **前端技术**：HTML、CSS、JavaScript
- **模板引擎**：Jinja2（内嵌在Python代码中）
- **文件存储**：图片以BLOB格式存储在数据库中

## 数据库结构

项目使用SQLite数据库，包含以下表：

- `images`：存储图片信息（ID、文件名、二进制数据、哈希值、评分）
- `tags`：存储标签信息（ID、标签名）
- `image_tags`：图片与标签的多对多关系表

## 安装和运行

1. **安装依赖**
   ```bash
   pip install flask
   ```

2. **运行应用**
   ```bash
   python app.py
   ```

3. **访问应用**
   打开浏览器访问 `http://localhost:5000`

## 主要功能

### 首页功能

- **标签云**：展示所有标签，点击可查看对应图片
- **导航菜单**：
  - 查看所有图片
  - 查看未标记标签的图片
  - 查看1星评价的图片
  - 随机浏览图片
  - 批量异步上传
  - 管理标签
  - 导出所有图像

### 图片管理

- **上传图片**：支持批量异步上传
- **浏览图片**：列表视图和相册视图切换
- **删除图片**：单张或批量删除
- **分页功能**：支持大量图片的分页浏览

### 标签管理

- **创建标签**：添加新标签
- **重命名标签**：修改标签名称
- **删除标签**：删除不需要的标签
- **标签分配**：为图片分配标签

### 评分系统

- **评分功能**：为图片打1-5星评分
- **筛选功能**：查看特定评分的图片

### 批量操作

- **批量标签**：为多张图片批量添加、删除或替换标签
- **批量重命名**：基于标签前缀批量重命名图片
- **一键清理**：一键删除所有1星图片

### 随机浏览

- **随机显示**：随机显示一张图片
- **导航功能**：键盘方向键、点击箭头、滑动手势切换图片
- **上下文浏览**：在特定标签或评分范围内浏览
- **标签编辑**：在浏览时直接编辑图片标签

### 导出功能

- **批量导出**：将所有图片导出为TAR压缩包
- **智能命名**：根据标签自动为图片命名
- **进度跟踪**：实时显示导出进度

## 使用说明

### 上传图片

1. 点击首页的"批量异步上传"
2. 选择要上传的图片文件
3. 点击"开始上传"按钮
4. 上传完成后图片会自动存储到数据库

### 为图片添加标签

1. 进入图片列表页面
2. 点击"编辑标签"或"标记标签"
3. 选择现有标签或创建新标签
4. 保存更改

### 批量操作

1. 在图片列表页面选择要操作的图片
2. 点击"批量修改标签"或"批量重命名"
3. 按照提示完成操作

### 随机浏览

1. 点击首页的"随机浏览图片"
2. 使用键盘方向键、点击箭头按钮或滑动手势切换图片
3. 可以直接在浏览页面为图片评分或编辑标签

## API接口

项目提供以下API接口：

- `GET /` - 首页
- `GET /images` - 查看所有图片
- `GET /untagged_images` - 查看未标记图片
- `GET /one_star_images` - 查看1星图片
- `GET /tag/<tag_id>/images` - 查看特定标签图片
- `GET /random_viewer` - 随机浏览图片
- `GET /image/<image_id>` - 获取图片数据
- `POST /upload_async` - 异步上传图片
- `POST /api/add_tag` - 添加标签
- `POST /api/rate_image` - 评分图片
- `POST /api/update_image_tags` - 更新图片标签
- `GET/POST /tags` - 标签管理
- `POST /batch_tags_update` - 批量标签操作
- `POST /batch_rename_execute` - 批量重命名
- `POST /api/start_export` - 开始导出
- `GET /api/export_progress` - 获取导出进度
- `GET /download_export` - 下载导出文件

## 文件结构

```
相册网盘单脚本版/
└── app.py              # 单文件Flask应用
```

## 设计特色

1. **单文件设计**：所有功能集成在一个Python文件中，便于部署和维护
2. **PIXIV风格UI**：采用蓝色主题的现代化界面设计
3. **响应式布局**：适配各种屏幕尺寸的设备
4. **触摸友好**：支持移动端的手势操作
5. **智能图片去重**：基于图片哈希值防止重复上传
6. **高效数据库操作**：使用索引和优化的SQL查询

## 扩展建议

- 添加用户认证系统
- 支持更多图片格式
- 添加图片编辑功能
- 实现图片搜索功能
- 添加分享功能
- 支持云存储后端
- 增加图片压缩功能

## 许可证

此项目为个人项目，仅供学习和参考使用。